<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Sensor Detail: {{ sensorName }}</h1>
    </div>
    
    <div *ngIf="loading" us-spinner style="position: relative"></div>

    <p class="col-lg-12 lead" *ngIf="details==undefined && !loading">
        This sensor does not exist or you do not have access to it.
    </p>

    <div *ngIf="details != undefined">
        <div class="col-lg-6" *ngIf="!loading">
            <div class="panel panel-info">
                <div class="panel-heading">Properties</div>
                <div class="panel-body">
                    <div *ngFor="let item of details.properties | keyvalue">
                        <p *ngIf="item.key !== 'fields' && item.key !== 'geographical' && item.key !== 'values' && item.key !== 'latitude' && item.key !== 'longitude'">
                          <b>{{ item.key }}:</b> {{ item.value }}
                        </p>
                      </div>
                      <div *ngIf="details.user.logged">
                        <button *ngIf="details.user.favorite" (click)="removeFavorite(sensorName)">Remove from favorites</button>
                        <button *ngIf="!details.user.favorite" (click)="addFavorite(sensorName)">Add to favorites</button>
                      </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6" *ngIf="!loading">
            <div class="panel panel-info">
              <div class="panel-heading">Geographical data</div>
              <div class="panel-body">
                <p *ngIf="details.properties.geographical">
                  <b>Location:</b> {{ details.properties.geographical }}
                </p>
                <div *ngFor="let item of details.geometry | keyvalue">
                  <p *ngIf="item.key !== 'coordinates'">
                    <b>{{ item.key }}:</b> {{ item.value }}
                  </p>
                </div>
                <ul>
                  <li *ngIf="details.geometry.coordinates[0]">
                    <b>Latitude:</b> {{ details.geometry.coordinates[0]}}
                  </li>
                  <li *ngIf="details.geometry.coordinates[1]">
                    <b>Longitude:</b> {{ details.geometry.coordinates[1]}}
                  </li>
                  <li *ngIf="details.geometry.coordinates[2]">
                    <b>Altitude:</b> {{ details.geometry.coordinates[2]}}
                  </li>
                </ul>
              </div>
            </div>
          </div>
          
          <div class="panel panel-info" *ngIf="details.properties.stats && (details.properties.stats['start-datetime'] || details.properties.stats['end-datetime'])">
            <div class="panel-heading">Statistics</div>
            <div class="panel-body">
              <div *ngFor="let item of details.properties.stats | keyvalue">
                <p *ngIf="item.key !== 'coordinates'">
                  <b>{{ item.key }}:</b> {{ item.value }}
                </p>
              </div>
            </div>
          </div>
          
        </div>

        <p class="col-lg-12 lead" *ngIf="!loading && details.user.logged && !details.user.has_access">
            You do not have access to this sensor's data. If you think you should have access, please contact your organization or make sure you have linked this account to your server's account.
          </p>
          
        <p class="col-lg-12 lead" *ngIf="!loading && !details.user.logged">
            As a non-registered user, you do not have access to this sensor's data, only its metadata. Please log in or create an account.
        </p>

        <div class="col-lg-12" *ngIf="!loading && details.user.has_access">
            <div class="panel panel-primary">
              <div class="panel-heading">Data</div>
              <div class="panel-body">                
                <div class="col-lg-12">
                  <div class="row">
                    <p style="float: left; display:inline-block" *ngIf="details.properties.values">
                      <br>
                      {{ details.properties.values.length }} results found for the specified timeframe.
                    </p>
                    <p style="float:left; display:inline-block" *ngIf="!details.properties.values">
                      <br>
                      <b>No data found for the specified timeframe.</b>
                    </p>
                    <h4 style="float: right; display:inline-block">Page size:
                      <b class="form-inline">
                        <input type="number" min="1" max="100" class="form-control" placeholder="25" [formControl]="pageSize">
                      </b>
                      <button type="button" class="btn btn-primary form-inline" (click)="updateRowCount(pageSize)">Apply</button>
                    </h4>
                  </div>
                  <div class="form-group">
                    <label class="checkbox-inline" *ngFor="let field of details.properties.fields">
                      <input type="checkbox">
                      {{ field.name }}
                    </label>
                  </div>
                  <table id="sensor_data_table_id" class="table table-bordered table-hover table-striped" *ngIf="details.properties.fields">
                    <thead>
                      <tr>
                        <th *ngFor="let field of details.properties.fields; let i = index">
                          <div *ngIf="columns[i]">
                            {{ field.name }}
                            ({{ field.type }}<span *ngIf="field.unit">, {{ field.unit }}</span>)
                          </div>
                        </th>
                      </tr>
                    </thead>
                    <tbody *ngIf="details.properties.values">
                      <tr *ngFor="let values of details.properties.values; let i = index" dir-paginate="values in details.properties.values | itemsPerPage: truePageSize ">
                        <td *ngFor="let value of values; let j = index"><span *ngIf="columns[j]">{{ value }}</span></td>
                      </tr>
                    </tbody>
                  </table>
                  <!-- <dir-pagination-controls max-size="10" directionLinks="true" boundaryLinks="true"></dir-pagination-controls> -->
                  <div class="row">
                    <div class="col-lg-6">
                      <button class="btn btn-success btn-block" [disabled]="!details.properties.values" (click)="download()">
                        <i class="fa fa-download"></i>
                        Download
                      </button>
                    </div>
                  </div>
                  <br>
                  <br>
                  <!-- <highchart *ngIf="details.properties.values" id="chart1" [config]="chartConfig"></highchart> -->
                  <br>
                  <!-- <button class="btn btn-primary" (click)="compare()" [disabled]="!details.properties.values">Compare this graph</button> -->
                  <br>
                  <br>
                  <!-- <button class="btn btn-info" (click)="addFilter(1, '>', 1, filterFunctionList.length)">Add a filter</button> -->
                  <br>
                  <br>
              </div>
            </div>
          </div>
    </div>

